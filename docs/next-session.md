# Next Session

## Branch
- current: `feature/backup-exclude-rules`

## Session Handoff
- next task: Continue audit P0 work by hardening HR stale-callback handling (`HrBleClient` stale characteristic + stale connection close).
- DoD:
  - HR `onCharacteristicChanged` ignores stale GATT callbacks.
  - Stale `onConnectionStateChange` callbacks close stale GATT deterministically.
  - Unit tests added for both stale paths.
  - PR merged cleanly and `build-test-lint` remains green.
- risks:
  - Backup exclusions intentionally prevent restoring local settings/summaries on a new device.
  - HR stale guards must not suppress valid data after reconnect.
- validation commands:
  - `./gradlew :app:lintDebug --no-daemon`
  - `./gradlew :app:testDebugUnitTest --no-daemon`
  - `./gradlew :app:assembleRelease --no-daemon`

## Recently Completed
- Backup policy hardened with explicit exclusions (offline-first/privacy):
  - Updated `app/src/main/res/xml/data_extraction_rules.xml` to exclude:
    - `sharedpref/ergometer_app_settings.xml`
    - all `file/.`
    - all `database/.`
  - Updated `app/src/main/res/xml/backup_rules.xml` with matching exclusions.
  - Documented backup behavior in `README.md` (`Backup policy` section).
  - Validated with:
    - `./gradlew :app:lintDebug --no-daemon`
- Released `v0.1.0` to GitHub:
  - Merged PR `#23` (`feature/v0-1-0-release-prep` -> `main`).
  - Tagged `main` as `v0.1.0`.
  - Published GitHub Release with signed APK asset:
    - `https://github.com/JyriWee/ergometer-app/releases/tag/v0.1.0`
  - Restored strict review policy to `required_approving_review_count=1` after merge.
- `v0.1.0` version decision and baseline update:
  - Updated `app/build.gradle.kts`:
    - `versionName = "0.1.0"`
    - `versionCode = 2`
  - Verified local validation after version bump:
    - `./gradlew clean :app:compileDebugKotlin :app:lintDebug --no-daemon`
- Signed release pipeline setup and verification:
  - Generated local release keystore at `.local/release-signing/ergometer-release.jks` (gitignored).
  - Generated local signing env file at `.local/release-signing/release-signing.env` (gitignored).
  - Configured GitHub repository secrets:
    - `ANDROID_RELEASE_KEYSTORE_B64`
    - `ANDROID_RELEASE_STORE_PASSWORD`
    - `ANDROID_RELEASE_KEY_ALIAS`
    - `ANDROID_RELEASE_KEY_PASSWORD`
  - Verified signed release build end-to-end:
    - `:app:assembleRelease` (PASS)
    - `:app:lintRelease` (PASS)
  - Verified produced signed APK at:
    - `app/build/outputs/apk/release/app-release.apk`
  - Updated branch-protection posture on GitHub:
    - Repo visibility set to public.
    - Required status check enforced on `main`: `build-test-lint` (`strict=true`).
    - Admin bypass disabled (`enforce_admins=true`).
- Release preparation docs baseline:
  - Added `docs/release-checklist.md` with DoD-driven release flow and artifact mode split (unsigned/signed).
  - Added `CHANGELOG.md` with initial `v0.1.0` entry.
  - Added `docs/release-notes-v0.1.0.md` as GitHub Release draft content.
  - Updated `README.md` documentation index with release docs links.
- Open-source readiness baseline (MIT):
  - Added `LICENSE` (MIT).
  - Added community docs: `CONTRIBUTING.md`, `CODE_OF_CONDUCT.md`, `SECURITY.md`.
  - Added GitHub templates: bug report, feature request, issue template config, and PR template.
  - Updated `README.md` with an explicit Open Source section linking governance documents.
- Workout editor theme parity pass (dark/light):
  - Added explicit safe-area handling (`WindowInsets.safeDrawing`) so editor content no longer clips under status/navigation bars.
  - Applied explicit theme background to editor root for consistent dark/light rendering.
  - Added subtle theme-aware borders to editor cards (step/validation/preview) to improve light-theme separation while keeping dark-theme calm.
  - Kept editor layout and behavior unchanged.
  - Verified locally:
    - `./gradlew :app:compileDebugKotlin --no-daemon`
    - `./gradlew :app:lintDebug --no-daemon`
  - Verified on-device with dark/light screenshots; accepted as "good enough" for this iteration.
- Summary screen theme parity pass (dark/light):
  - Applied explicit theme background to summary root container for deterministic dark/light rendering.
  - Added subtle theme-aware borders to summary section card and summary metric cards for better light-theme separation while keeping dark-theme calm.
  - Kept summary layout and content unchanged.
  - Verified locally:
    - `./gradlew :app:compileDebugKotlin --no-daemon`
    - `./gradlew :app:lintDebug --no-daemon`
  - Verified on-device with dark/light screenshots; accepted as "good enough" for this iteration.
- Session screen theme parity pass (dark/light):
  - Added subtle theme-aware card borders for session summary surfaces (`TopTelemetrySection`, `WorkoutProgressSection`, `SessionIssuesSection`) to improve separation on light theme without dark-theme overemphasis.
  - Kept layout/content unchanged; only visual contrast tuning.
  - Verified locally:
    - `./gradlew :app:compileDebugKotlin --no-daemon`
    - `./gradlew :app:lintDebug --no-daemon`
  - Verified on-device with dark/light screenshots; accepted as "good enough" for this iteration.
- Finalized MENU theme contrast after on-device dark/light verification:
  - Applied theme background to the MENU root container so dark theme no longer renders dark text on a light surface.
  - Increased secondary button contrast by using `primaryContainer/onPrimaryContainer`.
  - Improved disabled `Start session` legibility by using explicit themed disabled colors instead of low-alpha primary tint.
- Completed UI list item 1 (theme color refactor pass):
  - Replaced remaining hardcoded Menu card/text/device-indicator colors in `Screens.kt` with theme-driven values.
  - Updated Menu card helpers to use centralized themed card colors.
  - Updated Workout Editor step-card and text-field colors in `WorkoutEditorScreen.kt` to follow `MaterialTheme.colorScheme`.
  - Verified locally:
    - `./gradlew :app:compileDebugKotlin --no-daemon`
    - `./gradlew :app:lintDebug --no-daemon`
- Improved workout editor step-card readability:
  - Step cards now use a white container with dark content text and a subtle border for higher contrast on bright backgrounds.
  - Step input fields now use white filled containers with darker borders so values remain readable inside step cards.
- Clarified workout editor step-order controls:
  - Renamed step reordering button labels from `Up` / `Down` to `Move step earlier` / `Move step later`.
  - Rebalanced step action row button widths and tightened button content spacing so all four actions remain on one row with longer labels.
- Added a full offline ZWO format reference to avoid future web dependency:
  - New document: `docs/zwo-format-reference.md`
  - Includes observed root elements, workout child elements, per-step attribute inventory, parser normalization rules, export scope, and maintenance commands.
- Updated documentation index and compatibility doc links:
  - `README.md` now links both ZWO docs.
  - `docs/zwo-format-compatibility.md` points to the full reference.
- Fixed workout editor export filename behavior:
  - Switched `CreateDocument` MIME from `application/xml` to `application/octet-stream` so document providers keep the suggested `.zwo` suffix (avoids auto-appended `.xml`).
- Extended ZWO parser compatibility based on external ZWO field reference:
  - Added support for step aliases: `Freeride`, `SolidState`, `MaxEffort`.
  - Added power fallbacks for common variants:
    - Warmup/Cooldown/Ramp: fallback from `Power` to low/high when needed.
    - SteadyState/SolidState: fallback from `PowerLow`/`PowerHigh` average when `Power` is missing.
    - IntervalsT: fallback from `PowerOnLow/High` and `PowerOffLow/High` when `OnPower`/`OffPower` are missing.
  - Added parser tests for alias handling and fallback power mapping in `ZwoParserTest`.
- Added compatibility documentation with web sources:
  - `docs/zwo-format-compatibility.md`
- Switched workout editor power input semantics from fraction to percentage:
  - Editor input fields now use percentage values (e.g., `80`) to match UI labels.
  - Import conversion maps stored workout fractions to editor percentages (e.g., `0.80 -> 80`).
  - Build/export conversion maps editor percentages back to workout fractions (`80 -> 0.80`) for unchanged ZWO output format.
  - Validation range now enforces percentage limits (`30-200`).
  - Updated default step values in editor actions to percentage-based inputs.
  - Extended `WorkoutEditorMapperTest` assertions to verify both import and export conversion behavior.
- Updated workout editor initialization behavior (Option A):
  - `WorkoutEditorDraft.empty()` now starts with zero steps (no prefilled step).
  - `MainViewModel` `nextWorkoutEditorStepId` now starts at `1L` and remains monotonic after add/duplicate/import.
  - `WorkoutEditorMapper.fromWorkout(...)` no longer injects a fallback steady step when imported workout has no editor-supported steps.
  - Added unit test `fromWorkoutLeavesDraftEmptyWhenNoSupportedStepsExist`.
  - Practical effect: users explicitly choose the first step type (including warmup-style ramp via `Add ramp step`).
- Refined workout editor usability pass:
  - Updated editor top text fields to explicit black text/border styling for stronger readability.
  - Renamed power labels from fraction terminology to user-facing `FTP percentage (%)`.
  - Updated add-step button labels to explicit action wording (`Add steady step`, `Add ramp step`, `Add intervals step`).
  - Added mandatory save prompt when applying unsaved editor draft to menu selection:
    - `Save and apply` opens document export and applies on successful save.
    - `Apply without save` allows immediate apply after explicit confirmation.
- Implemented in-app workout editor MVP foundation:
  - Added new destination `WORKOUT_EDITOR` and menu entry point (`Open workout editor`).
  - Added editor draft models/actions for supported step types (`Steady`, `Ramp`, `Intervals`).
  - Added editor mapper with validation and strict conversion to `WorkoutFile`.
  - Added `.zwo` serializer for supported step tags and wired export through `CreateDocument`.
  - Added `SessionOrchestrator.onWorkoutEdited(...)` so editor output can be applied directly to menu session selection.
  - Added preview metrics on editor screen via existing chart + planned TSS/step counter pipeline.
  - Added unit tests for editor mapper/serializer (`WorkoutEditorMapperTest`).
  - Updated `MainActivityContentFlowTest` fixture for extended UI model/callback contract.
- Added focused low-latency guard unit coverage in BLE layer:
  - Extracted guard logic into `LowLatencyScanStartGate` to keep scanner pacing behavior directly testable.
  - Added `LowLatencyScanStartGateTest` for cooldown, throttle-backoff, rolling-window cap, and non-low-latency bypass behavior.
  - Kept `BleDeviceScanner` behavior unchanged by routing start-delay decisions through the extracted guard.
- Added testable device-scan policy extraction:
  - New `DeviceScanPolicy` centralizes picker/probe scan mode mapping and picker completion decisions (retry/error/no-results/done).
  - `MainViewModel` now uses this policy for retry gating and scan completion status classification.
- Added focused JVM regression tests:
  - `DeviceScanPolicyTest.pickerUsesLowLatencyAndProbeUsesBalancedMode`
  - `DeviceScanPolicyTest.retryTooFrequentRequiresAllowFlagActivePickerAndCodeSix`
  - `DeviceScanPolicyTest.completionClassificationMapsToExpectedUiStatusPath`
- Added proactive low-latency scan start window guard in `BleDeviceScanner`:
  - Tracks successful low-latency starts in a global 30-second rolling window.
  - Caps starts to 3 per window to avoid Android scanner registration throttle (`status=6`) during rapid picker restart patterns.
  - Integrates with existing restart cooldown and post-failure backoff.
- Added BLE scanner diagnostics for throttle root-cause analysis:
  - `BleDeviceScanner` now records a global ring-buffer scan journal with source label (`picker`, `probe_ftms`, `probe_hr`), service, mode, and lifecycle events.
  - On Android scan throttle failure (`status=6`), journal is dumped to LogCat automatically for timeline analysis.
- Hardened picker UX against rapid start/stop tap patterns:
  - Added a 3-second safety lock for the picker `Stop scanning` button at scan start.
  - Unlocks early as soon as at least one matching device is discovered.
  - Always unlocks when scan stops/fails so the picker can be closed deterministically.
- Implemented menu scan-cost hardening for passive availability probes:
  - Added configurable `scanMode` to `BleDeviceScanner.start(...)` (default remains low-latency for interactive picker scans).
  - Switched trainer/HR background MENU probes to `SCAN_MODE_BALANCED`.
  - Kept interactive picker scanning behavior unchanged.
- Validated passive probe tuning locally:
  - `:app:compileDebugKotlin`
  - `:app:testDebugUnitTest --tests "com.example.ergometerapp.session.SessionOrchestratorFlowTest" --tests "com.example.ergometerapp.session.SessionManagerEdgeCaseTest"`
  - `:app:lintDebug`
- Implemented audit P0-3 stop-flow persistence hardening:
  - `SessionManager` now queues session summary persistence to a background single-thread executor.
  - Summary publication (`lastSummary`, phase transition, emitted UI state) remains synchronous on main thread.
  - Added guarded persistence error logging to avoid crash on storage failures.
- Added P0-3 regression test coverage:
  - `SessionManagerEdgeCaseTest.stopSessionQueuesPersistenceWithoutBlockingSummaryPublication`.
- Validated P0-3 locally:
  - `:app:compileDebugKotlin`
  - `:app:testDebugUnitTest --tests "com.example.ergometerapp.session.SessionManagerEdgeCaseTest" --tests "com.example.ergometerapp.session.SessionOrchestratorFlowTest"`
  - `:app:lintDebug`
- Implemented audit P0-2 FTMS telemetry/log pressure reduction:
  - Added Indoor Bike telemetry coalescing in `FtmsBleClient` with a 200 ms main-thread update cadence (latest sample wins).
  - Replaced per-notification debug spam with debug-only sampled rate logging.
  - Added debug-gated FTMS verbose logging helpers in `FtmsBleClient` and `FtmsController` to avoid release log noise and string-build overhead.
  - Kept protocol-critical callbacks (`onReady`, control-point response, ownership, disconnect) unthrottled.
- Validated P0-2 locally:
  - `:app:compileDebugKotlin`
  - `:app:testDebugUnitTest --tests "com.example.ergometerapp.ble.FtmsControllerTimeoutTest" --tests "com.example.ergometerapp.session.SessionOrchestratorFlowTest"`
  - `:app:lintDebug`
- Implemented audit P0-1 HR readiness hardening:
  - `HrBleClient` now emits `onConnected` only after HR CCCD write succeeds.
  - Added deterministic setup-abort path for missing service/characteristic/descriptor and notification setup failures.
  - Setup failures are no longer silent; failures now route through reconnect/disconnect handling with explicit reasons.
- Validated P0-1 locally:
  - `:app:compileDebugKotlin`
  - `:app:testDebugUnitTest --tests "com.example.ergometerapp.ble.HrReconnectCoordinatorTest"`
  - `:app:lintDebug`
- Added bilingual project-origin note in `docs/ai-assisted-development-note.md` (Finnish + English).
- Linked AI-assisted development note from `README.md`.
- Received latest external GitHub-Codex audit with prioritized findings (HR ready-state sequencing, FTMS main-thread/log pressure, SessionManager stop-time persistence threading, probe scan cost).
- Refreshed root `README.md` to reflect current project scope, setup, validation commands, configuration flags, and documentation index.
- Added contributor-facing architecture overview in `docs/architecture.md`.
- Added setup and development onboarding guide in `docs/onboarding.md`.
- Added BLE status and recovery behavior guide in `docs/ble-status-and-recovery.md`.
- Added CI release verification (`:app:assembleRelease` with minify + `:app:lintRelease`).
- Added optional secrets-based release signing wiring (no signing data in repository).
- Added release/signing documentation in `docs/ci-release-signing.md`.
- Fixed GitHub Actions expression error by removing direct `secrets` usage from step-level `if` condition.
- Updated UI layout:
  - Summary metrics now use two columns.
  - Menu: moved workout selection under device search buttons, added inline filename display.
  - Menu: added two scrollable metadata boxes for workout name/description tags.
- Updated Menu behavior/style:
  - Name/description metadata boxes are shown only when a workout is selected.
  - Filename box + metadata boxes use white card backgrounds.
- Removed user-visible MAC address exposure from Menu UI:
  - Manual MAC input fields removed from Menu.
  - Trainer/HR are shown as compact side-by-side device cards.
  - Device picker list now shows name + RSSI only (no MAC text).
- Adjusted workout row proportions to 30/70 (`Select workout` / filename display).
- Removed unused manual-MAC plumbing from app state/UI wiring:
  - Deleted Menu callback/model fields related to manual FTMS/HR MAC text input.
  - Refactored ViewModel to keep only selected device MACs from scanner/persistence.
  - Removed obsolete MAC-related string resources.
- Adjusted Menu top row:
  - Added one-line row with `FTMS based training session` (left), narrow FTP input (~1/6), and `Current FTP` hint (right).
  - FTP validation errors are shown below that row in red.
- Enabled project-wide Gradle configuration cache in `gradle.properties` and verified cache store/reuse in CLI builds.
- Enabled additional Gradle performance settings in `gradle.properties`:
  - `org.gradle.caching=true`
  - `org.gradle.jvmargs=-Xmx4096m -Dfile.encoding=UTF-8`
- Improved portrait Menu readability:
  - Fixed subtitle typo (`training`).
  - Increased device/metadata card label contrast to black.
- Updated device picker dismiss control:
  - Replaced filled cancel button with state-aware outlined button.
  - While scanning: shows `Stop scan` with amber warning styling.
  - When idle: shows `Close picker` with high-contrast neutral styling on dark background.
- Emphasized Menu primary action:
  - `Start session` now uses dedicated CTA styling (darker teal, white text, 56dp height).
  - Added leading play icon and semibold label weight.
  - Disabled CTA state remains clearly visible while preserving contrast.
- Tuned Menu visual hierarchy and selection clarity:
  - Secondary Menu actions (`Search trainer`, `Search HR`, `Select workout`) now use a lighter secondary button style to keep focus on `Start session`.
  - Added trainer/HR live connection status dots in device cards:
    - connected: pulsing green
    - disconnected: amber
  - Moved workout step count into the workout card header row next to `Workout`.
  - Added tap-to-open full workout filename dialog from the filename card to handle long names.
- Extended Menu tap-to-view details:
  - Added the same dialog presentation for `Workout name` and `Workout description` cards.
  - Workout chart header row text (`Workout` + step count subtitle) is now white for consistent contrast on the dark chart card.
- Refined MENU device status indicators with tri-state semantics:
  - `Connected`: pulsing green.
  - `Idle` (normal not-connected state before/after session): neutral gray.
  - `Issue` (trainer auto-connect failure prompt active): amber.
  - HR indicator uses connected/idle (green/gray) to avoid false warning color in normal idle state.
- Added automatic trainer availability probing on MENU:
  - Passive FTMS scan probe runs every 10 seconds for the selected trainer MAC.
  - Probe duration is 1.5 seconds for faster status refresh with controlled scan load.
  - Probe result feeds trainer indicator without opening a GATT/control-point session.
  - Picker scans and session start temporarily suspend probe scanning to avoid scan contention.
  - Trainer indicator stays gray until first probe result is known, then shows green/amber based on availability.
- Added automatic HR availability probing on MENU (longer interval than trainer):
  - Passive HR scan probe runs every 30 seconds for the selected HR MAC.
  - HR indicator now mirrors trainer semantics (green when reachable/connected, amber when known unreachable, gray before first known state).
- Stabilized HR status indicator against transient BLE advertisement misses:
  - Added HR hysteresis (`hrStatusMissThreshold = 2`, `hrStatusStaleTimeoutMs = 75s`).
  - Single missed probe no longer flips HR to amber.
  - Reachable state is refreshed immediately on confirmed HR connection callbacks.
- Improved picker scan feedback on MENU:
  - While scanning, picker status text now shows animated trailing dots (`.`, `..`, `...`) in a calm loop.
  - Keeps scan feedback visible without introducing spinner/noisy motion.
- Added planned workout TSS calculation (FTP-aware) from execution segments:
  - New `WorkoutPlannedTssCalculator` with one-decimal output.
  - Uses strict execution mapping to avoid showing misleading values for unsupported/invalid workouts.
  - Supports steady, ramp (integrated IFÂ²), and expanded interval segments.
- Wired planned TSS into state orchestration and Menu UI:
  - Recomputed on workout import and on FTP changes.
  - Shown in the Menu workout header row next to step count.
- Added unit tests for planned TSS calculation:
  - steady 1h @ FTP, ramp integration, interval expansion, and mapping-failure null case.
- Fixed Compose lint error (`UnusedBoxWithConstraintsScope`) in `SummaryScreen`:
  - Replaced unnecessary `BoxWithConstraints` with `Box` in summary root.
  - Kept `BoxWithConstraints` in `SessionScreen` where `maxWidth` is required.
  - Verified with `:app:lintDebug`.
- Hardened request-control failure handling for session start:
  - Added deterministic rollback path from `CONNECTING/SESSION` to `MENU` when request-control is rejected.
  - Added deterministic rollback path when request-control times out.
  - Shows actionable connection issue prompt with `Search again` CTA for both reject and timeout cases.
- Added command-timeout callback in `FtmsController`:
  - Timeout now reports the in-flight request opcode to orchestrator.
  - Tracks in-flight opcode for diagnostics and timeout routing.
- Added unit test coverage for controller timeout callback behavior:
  - `FtmsControllerTimeoutTest` verifies request-control timeout opcode reporting and no timeout signal when write-start fails.
- Added local unit-test `android.util.Log` stub to avoid JVM test crashes from Android Log mocking gaps.
- Implemented P0-2 FTMS response-correlation hardening:
  - `FtmsController` now validates Control Point responses against the expected in-flight opcode.
  - Mismatched responses are ignored (BUSY remains active) until matching response or timeout.
  - Responses received with no in-flight command are classified separately.
  - Added `onUnexpectedControlPointResponse` diagnostics callback for orchestration/debug flow.
- Added/extended FTMS controller tests:
  - Timeout callback still reports request opcode.
  - Mismatched response does not release BUSY and eventually times out the expected command.
  - No-in-flight response is reported as unexpected with explicit reason.
- Implemented P0-3 long-session memory hardening in `SessionManager`:
  - Replaced unbounded per-sample arrays with memory-stable streaming aggregates (`count/sum/max`).
  - Preserved summary output semantics (`avg` as integer truncation, `max` nullable when no samples).
  - Kept HR source preference invariant (external strap preferred; bike HR only when strap data is absent).
  - Validated with `:app:compileDebugKotlin` and `:app:lintDebug`.
- Added streaming "actual TSS" calculation for completed sessions:
  - Introduced `ActualTssAccumulator` (rolling-window NP-style smoothing + one-decimal TSS output).
  - Wired session-start FTP into `SessionManager.startSession(ftpWatts)`.
  - Added `actualTss` to `SessionSummary`, Summary UI, and text export (`SessionStorage`).
  - Added unit tests in `ActualTssAccumulatorTest`.
- Hardened actual TSS gap handling with conservative hold limits:
  - Added `maxHoldSeconds` to `ActualTssAccumulator` (default: 3 s).
  - Gaps beyond hold limit are counted as zero power to avoid optimistic TSS inflation.
  - Added regression test that verifies conservative behavior under sparse telemetry.
- Completed P0-4 FTMS flow regression coverage with deterministic JVM tests:
  - Added `SessionOrchestratorFlowTest` for request-control reject rollback, timeout rollback, request-control success start transition, and stop-flow to summary transition.
  - Added test hooks in `SessionOrchestrator` for deterministic FTMS-event simulation without BLE hardware.
  - Injected `mainThreadHandler` into `SessionOrchestrator` constructor to avoid implicit timing races in tests.
  - Hardened test Android Looper stub with `myLooper()` and `getThread()` for Compose runtime compatibility.
- Implemented P1-1 HR lifecycle hardening:
  - Added `HrReconnectCoordinator` with bounded exponential backoff reconnect policy.
  - Extended `HrBleClient` with deterministic disconnect callback support and reconnect orchestration.
  - Wired `MainViewModel` to clear HR state when HR link disconnects.
- Added targeted HR reconnect/disconnect unit coverage:
  - New `HrReconnectCoordinatorTest` covers bounded retries, explicit-close suppression, and backoff reset after successful reconnect.
- Added targeted `SessionManager` edge-case tests:
  - New `SessionManagerEdgeCaseTest` covers short/no-data sessions and conservative TSS behavior under sparse telemetry gaps.
- Added first critical-flow instrumentation coverage:
  - New `MainActivityContentFlowTest` verifies `MENU -> CONNECTING -> SESSION -> STOPPING -> SUMMARY` rendering anchors.

## Next Task
- Continue workout editor MVP hardening:
  - Run practical device verification for editor save/apply flow (new draft, load selected, save `.zwo`, re-import, start session).
  - Improve editor step UX (optional step-type conversion and tighter field layout on tablet portrait).
  - Add focused tests for validation boundary values and editor-to-session apply flow.

## Definition of Done
- Implementation is done on a dedicated feature branch (not `main`).
- Editor supports create/edit for steady/ramp/interval steps with deterministic validation and apply/save actions.
- Exported `.zwo` files are accepted by the existing importer and preserve planned TSS/step count semantics.
- No functional changes to workout/session flow.
- No regressions in compile/test/lint for touched scope.
- Session handoff notes are updated for the next increment.

## Risks / Open Questions
- Keep commit size controlled; propose commit as soon as each tested increment is complete.
- Android BLE scan APIs are difficult to unit test without abstraction; may require a narrow indirection layer.
- Decide whether to keep current probe intervals or tune them after practical battery tests.

## Validation
1. `./gradlew :app:compileDebugKotlin --no-daemon`
2. `./gradlew :app:testDebugUnitTest --tests "com.example.ergometerapp.ZwoParserTest" --tests "com.example.ergometerapp.workout.editor.WorkoutEditorMapperTest" --tests "com.example.ergometerapp.DeviceScanPolicyTest" --tests "com.example.ergometerapp.ble.LowLatencyScanStartGateTest" --no-daemon`
3. `./gradlew :app:compileDebugAndroidTestKotlin --no-daemon`
4. `./gradlew :app:lintDebug --no-daemon`
